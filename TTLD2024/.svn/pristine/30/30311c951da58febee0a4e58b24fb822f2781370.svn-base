var MISA=MISA||{};MISA.CommonFn={config:{gridChangeData:{},},constant:{htmlDateExtFormat:'Y-m-d',},detectMIMEType:function(base64string){if(Ext.isEmpty(base64string)){return "";}
var firstChar=base64string[0];switch(firstChar){case "i":return "data:image/png;base64,";case "/":return "data:image/jpg;base64,";case "P":return "data:image/svg+xml;base64,";case "U":return "data:image/webp;base64,";case "R":return "data:image/gif;base64,";case "J":return "data:application/pdf;base64,";default:return "data:image/png;base64,";}},redirectToVinmeo:function(type){var id='';switch(type){case MISA.Enumeration.Vinmeo.Overview:id='482472649';break;case MISA.Enumeration.Vinmeo.OrganizationInfomation:id='538987883';break;case MISA.Enumeration.Vinmeo.Category:id='518872900';break;case MISA.Enumeration.Vinmeo.EmployeeList:id='531573245';break;case MISA.Enumeration.Vinmeo.SortEmployeeList:id='521334737';break;case MISA.Enumeration.Vinmeo.EditReportTemplate:id='489241549';break;case MISA.Enumeration.Vinmeo.SetPayrollOption:id='487497445';break;case MISA.Enumeration.Vinmeo.PublicSynthesis:break;case MISA.Enumeration.Vinmeo.CalculatePayroll:break;case MISA.Enumeration.Vinmeo.CalculateOther:break;case MISA.Enumeration.Vinmeo.CalculateDeduction:break;case MISA.Enumeration.Vinmeo.CalculateRetroactive:break;case MISA.Enumeration.Vinmeo.CalculatePersonalIncomeTax:break;case MISA.Enumeration.Vinmeo.PrintPayrollAndSignDigital:id='498572009';break;case MISA.Enumeration.Vinmeo.SalaryReform:id='505156292';break;case MISA.Enumeration.Vinmeo.SalaryEstimationOption:id='498572366';break;default:break;}
if(id.length>0){var url='https://player.vimeo.com/video/'+id+'?title=1&byline=0&portrait=0';window.open(url,'_blank');}},subString:function(input,numberword){var me=this,value="";if(input&&input.length>numberword){value=input.substr(0,numberword)+"..."}else{value=input;}
return value;},buildModel:function(modelId,entityName,columns,itemId,phantomKey){var entity=eval('MISA.Entity.'+entityName);if(!Ext.isEmpty(entityName)&&entity){if(Ext.ClassManager.isCreated(modelId)){if(typeof modelId==="string"){return eval(modelId);}else{return modelId;}}else{var fields=[],config={extend:"Ext.data.Model",fields:fields},modelItemId=itemId;for(var n in entity){var pr=entity[n];if(pr.hasOwnProperty('IsKey')||Ext.isEmpty(columns)||columns=="*"||columns.indexOf(n)>-1){var field={allowNull:pr['IsNullable'],name:n};if(pr.hasOwnProperty('IsEnum')&&pr['IsEnum']){field['type']='int';}else{field['type']=this.getJSType(pr['Type']);}
fields.push(field);if(!modelItemId&&pr.hasOwnProperty('IsKey')&&pr['IsKey']){modelItemId=n;}}}
if(phantomKey){config['clientIdProperty']="PhantomKey";config['idProperty']="PhantomKey";}
else{config['clientIdProperty']=modelItemId;config['idProperty']=modelItemId;}
config['itemId']=modelItemId;var model=Ext.define(modelId,config);return model;}}},getJSType:function(serverType){var type='string';switch(serverType.toLowerCase()){case 'string':type='string';break;case 'datetime':case 'date':type='date';break;case 'int16':case 'int32':case 'int64':case 'int':type='int';break;case 'bool':case 'boolean':type='boolean';break;case 'guid':type='string';break;case 'byte[]':case 'object':type='auto';break;case 'timespan':type='string';break;case 'decimal':case 'double':type='float';break;default:type='string';break;}
return type;},clone:function(source){var target={};for(var i in source){target[i]=source[i];}
return target;},getEntityConfig:function(entityName){return entityName?eval('MISA.Entity.'+entityName):null;},getBaseUrl:function(){return "/";},getKeyTokenDataIDForDownload:function(){return MISA.ContextData.OrganizationID+"-"+MISA.ContextData.UserId+"-"+new Date().getTime();},getDownloadUrl:function(){return "/Handler/DownloadHandler.ashx?InfoParam="+this.getKeyTokenDataIDForDownload();},getUploadUrl:function(){var me=this;return 'UploadHandler.axd';},getImageHandlerUrl:function(){return '/ImageHandler.axd';},downloadFile:function(path,idIndex){if(!idIndex){idIndex="";}
var id="ifDownloadFile{0}".format(idIndex);if($('#{0}'.format(id)).length==0){$('body').append('<iframe id="{0}" class="hideiframe" src=""></iframe>'.format(id));}
$('#{0}'.format(id)).attr('src',path);},checkLicenseRule:function(formID){return true;},checkPermission:function(formID,editMode){return true;},showErrorTip:function(target,msg,config){var me=this,cf=config||{},of=$(target).offset();var tip=Ext.create('Ext.tip.ToolTip',{target:target,cls:'x-tip-form-invalid',bodyCls:'x-tip-body-form-invalid x-tip-body-form-invalid',html:msg,autoShow:true,autoHide:true,constrainPosition:true,constrainTo:document.body,dismissDelay:cf.dismissDelay||1000,targetXY:[of.left+$(target).width(),of.top+10],});tip.on('hide',function(){if(!this.isDestroyed){this.destroy();this.isDestroyed=true;}},tip,{delay:cf.delay||2,single:true});return tip;},showSuccessAutoHideMess:function(message){var me=this;message=message?message:'Cất thành công.';MDSnackbars.showSuccess(message);},convertDateToWireFormat:function(date){var newDate=date.addMinutes(-date.getTimezoneOffset());return '/Date('+newDate.getTime()+')/';},parseCustomColumn:function(customColumn){var me=this,res=[];if(customColumn){var columns=customColumn.split('|');columns.filter(function(colConfig){if(colConfig.trim()!=''){var config=colConfig.split('{'),field=config[0];var col={ChildColumns:null,DataField:field,DataType:MISA.Enumeration.DataType.Default,EnumName:null,Filterable:true,Flex:0,HeaderText:MISA.Resource.EntityResource[field],HeaderTooltip:null,IsIDColumn:false,IsLocked:false,IsTreeColumn:false,ReadOnly:false,Sortable:false,Tag:null,Width:null}
if(config.length>1){var properties=config[1].replace('}','').split(';');properties.filter(function(p){var name=p.split(':')[0],value=p.split(':')[1];switch(name.toLowerCase()){case 'resourcekey':col.HeaderText=MISA.Resource.EntityResource[value];break;case 'datatype':case 'columndatatype':col.DataType=MISA.Enumeration.DataType[value];break;case 'childcolumns':col.ChildColumns=me.parseCustomColumn(value);break;case 'tooltip':col['HeaderTooltip']=MISA.Resource.EntityResource[value];break;case 'filterable':col[name]=value.bool();break;default:col[name]=value;break;}});}
res.push(col);}});}
return JSON.stringify(res);},getParameterByName:function(name){var i1=location.href.indexOf('#'),i2=location.href.indexOf('?'),i=-1,param='';if(i1!=-1&&i2!=-1){i=Math.min(i1,i2);}else if(i1!=-1&&i2==-1){i=i1;}else if(i2!=-1){i=i2;}
if(i!=-1){param=location.href.substr(i);}
name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&#]"+name+"=([^&#]*)");var results=regex.exec(param);return results==null?"":decodeURIComponent(results[1].replace(/\+/g," "));},showMask:function(container,msg){var selector=container;if(container&&container.rendered){if(typeof container==="string"){selector=$(container);}
selector.mask(msg||MISA.Resource.GlobalResource.Loading);}},hideMask:function(container){var selector=container;if(container&&container.rendered){if(typeof container==="string"){selector=$(container);}
selector.unmask();}},renderDisplayText:function(value){var res='',title;if(typeof value=='string'&&!value.isNullOrWhiteSpace()){title=$(jQuery.parseHTML(value)).text().replaceAll('"',"&quot;");res=Ext.String.format('<span title="{0}">{1}</span>',title,value);}else{res=value;}
if(typeof res==="string"){res=res.processXSS();}
return res;},processDisplayText:function(value){return value.replaceAll(' ','&nbsp;').processXSS();},formatValue:function(value,dataType,decimalPrecision){var me=this,sValue='';if(value!==undefined&&value!=null){switch(dataType){case MISA.Enumeration.DataType.DateType:format=MISA.Resource.ControlResource.dateField_format;sValue=Ext.util.Format.date(value,format);break;case MISA.Enumeration.DataType.DateTimeType:format=MISA.Resource.ControlResource.dateTime_format;sValue=Ext.util.Format.date(value,format);break;case MISA.Enumeration.DataType.TimeType:format=MISA.Resource.ControlResource.time_format;sValue=Ext.util.Format.date(value,format);break;case MISA.Enumeration.DataType.MoneyType:case MISA.Enumeration.DataType.DecimalType:case MISA.Enumeration.DataType.NumberType:case MISA.Enumeration.DataType.RateType:case MISA.Enumeration.DataType.PercentType:if(typeof value!=='undefined'&&value!==null&&value!==''){var decValue=new Decimal(value);var decimalDigits=me.getDecimalDigits(dataType);sValue=decValue.toFormat(decimalDigits);}else{sValue=value.toString();}
break;case MISA.Enumeration.DataType.CustomType:if(typeof value!=='undefined'&&value!==null&&value!==''){var decValue=new Decimal(value);if(decimalPrecision==null){decimalPrecision=2;}
sValue=decValue.toFormat(decimalPrecision);}else{sValue=value.toString();}
break;case MISA.Enumeration.DataType.ConfigTypeHSL:case MISA.Enumeration.DataType.ConfigTypeCofficent:if(typeof value!=='undefined'&&value!==null&&value!==''){var decValue=new Decimal(value);var option=me.getDataConfigFromDBoption();if(dataType==MISA.Enumeration.DataType.ConfigTypeHSL){decimalPrecision=option.RoundSalaryCoffient;}else if(dataType==MISA.Enumeration.DataType.ConfigTypeCofficent){decimalPrecision=option.RoundBenefitCoffient;}
sValue=decValue.toFormat(decimalPrecision);}else{sValue=value.toString();}
break;case MISA.Enumeration.DataType.Default:default:sValue=value;break;}}
return sValue;},getDecimalDigits:function(dataType,decimalPrecision){var me=this,result=0;switch(dataType){case MISA.Enumeration.DataType.MoneyType:case MISA.Enumeration.DataType.NumberType:result=0;break;case MISA.Enumeration.DataType.PercentType:case MISA.Enumeration.DataType.DecimalType:case MISA.Enumeration.DataType.RateType:result=2;break;case MISA.Enumeration.DataType.CustomType:if(decimalPrecision==null){decimalPrecision=2;}
result=decimalPrecision;break;case MISA.Enumeration.DataType.ConfigTypeHSL:case MISA.Enumeration.DataType.ConfigTypeCofficent:var option=me.getDataConfigFromDBoption();if(dataType==MISA.Enumeration.DataType.ConfigTypeHSL){decimalPrecision=option.RoundSalaryCoffient;}else if(dataType==MISA.Enumeration.DataType.ConfigTypeCofficent){decimalPrecision=option.RoundBenefitCoffient;}
result=decimalPrecision;break;default:result=0;break;}
return result;},getDataConfigFromDBoption:function(){var me=this,dataSetting={RoundBenefitCoffient:MISA.Enumeration.RoundCoffient.RoundThreeDigit,RoundSalaryCoffient:MISA.Enumeration.RoundCoffient.RoundTwoDigit,};roundSetting=MISA.DBOption.get("RoundingSettingSalary")||null;if(roundSetting){roundSettingObject=MISAJSON.parse(roundSetting);dataSetting.RoundCoffient=roundSettingObject.RoundCoffient;dataSetting.RoundSalaryCoffient=roundSettingObject.RoundSalaryCoffient;dataSetting.RoundBenefitCoffient=roundSettingObject.RoundBenefitCoffient;dataSetting.RoundMoney=roundSettingObject.RoundMoney;dataSetting.RoundMoneyReal=roundSettingObject.RoundMoneyReal;dataSetting.PaymentSourceID=roundSettingObject.PaymentSourceID;}
return dataSetting;},getFormatDigitsForSalary:function(value,dataType,isFormatDigits){var me=this,sValue='';if(typeof value!=='undefined'&&value!==null&&value!==''){var decValue=new Decimal(value);var decimalDigits;switch(dataType){case MISA.Enumeration.DataType.MoneyType:case MISA.Enumeration.DataType.NumberType:decimalDigits=0;break;case MISA.Enumeration.DataType.DecimalType:case MISA.Enumeration.DataType.RateType:decimalDigits=(isFormatDigits?4:2);break;case MISA.Enumeration.DataType.PercentType:decimalDigits=(isFormatDigits?4:0);break;default:decimalDigits=0;break;}
sValue=decValue.toFormat(decimalDigits);}else{sValue=value.toString();}
return sValue;},getByDigitDecimal:function(value,decimalDigits){var me=this,sValue='';if(typeof value!=='undefined'&&value!==null&&value!==''){var decValue=new Decimal(value);sValue=decValue.toFormat(decimalDigits);}else{sValue=value.toString();}
return sValue;},getThousandSeparator:function(){return '.';},getDecimalSeparator:function(){return ',';},getMaxValueByDataType:function(dataType){var me=this,result=99999999999999;switch(dataType){case MISA.Enumeration.DataType.DecimalType:case MISA.Enumeration.DataType.NumberType:result=9999999999;break;case MISA.Enumeration.DataType.RateType:case MISA.Enumeration.DataType.PercentType:result=100;break;case MISA.Enumeration.DataType.MoneyType:result=99999999999999;break;case MISA.Enumeration.DataType.YearType:result=9999;break;default:result=99999999999999;break;}
return result;},getDateStringByFormat:function(value,format){var me=this,res='';if(value&&Ext.isDate(value)){switch(format){case MISA.Enumeration.DateFormat.Full:res=Ext.Date.format(value,'d/m/Y');break;case MISA.Enumeration.DateFormat.MonthYear:res=Ext.Date.format(value,'m/Y');break;case MISA.Enumeration.DateFormat.Year:res=Ext.Date.format(value,'Y');break;default:res=Ext.Date.format(value,'d/m/Y');}}
return res;},getBaseUrl:function(){return "/";},getAppUrl:function(url){var res='';if(url){var appCh="_/index.html";if(url.indexOf(appCh)==0){res=this.getBaseUrl()+url.substring(appCh.length);}else{res=url;}}
return res;},getEntityText:function(resourceKey,data){var output=resourceKey,fIndex,lIndex,text=MISA.Resource.EntityResource.Object,result='';if(MISA.Resource.EntityResource.hasOwnProperty(resourceKey)){text=MISA.Resource.EntityResource[resourceKey];fIndex=text.indexOf("<");lIndex=text.indexOf(">");if(fIndex>=0&&lIndex>fIndex){var l=lIndex-fIndex-1,s=text.substr(fIndex+1,l),arr=s.split(",");if(data){arr.filter(function(a){var value=data[a];if(value){output=text.replaceAll(a,value);}});}else{arr.filter(function(a){output=text.replaceAll(a,'');});}
output=output.replaceAll('<','');output=output.replaceAll('>','');}else{output=text;}
result=Ext.String.htmlEncode(output);}else{MISA.MessageBox.showWarning(MISA.Resource.GlobalResource.MissingSystemConfig);}
return result;},getRootParent:function(obj){var o=obj||window;if(o!==o.parent){o=getRootParent(o.parent);}
return o;},redirectUrl:function(url,isBlank){if(isBlank){var a=document.getElementById('aBlank');if(!a){$('body').append('<a id="aBlank" class="hide" target="_blank" href="javascript:void(0)"></a>');a=document.getElementById('aBlank');}
a.href=url;a.click();}else{document.location.href=url;}},navigationPage:function(jsInstance,formID){var me=jsInstance,navConfig={formID:formID,target:'_self',};if(me.navigatePage){me.navigatePage(navConfig);}else{MISA.Navigation.navigatePage(navConfig);}},getEnumSource:function(enumName,ignoreKeys){var obj=eval("MISA.Enumeration."+enumName),arrIgnoreKeys=(ignoreKeys||'').split("|"),data=[];if(obj){for(var o in obj){if(arrIgnoreKeys.indexOf(o)==-1){var item={"EnumValue":obj[o],"EnumName":o,"DisplayText":MISA.Resource.EnumResource[enumName+"_"+o]||o,}
data.push(item);}}}
if(data.length>0){return data;}else{return undefined;}},getEnumText:function(enumName,value){var obj=eval("MISA.Enumeration."+enumName),text='';if(obj&&value!=null){for(var o in obj){if(obj[o]==value){text=MISA.Resource.EnumResource[enumName+"_"+o]||o;break;}}}
return text;},filterTree:function(store,fn){var items=[];var fnFilter=function(nodes){if(nodes){nodes.filter(function(node){if(fn(node)){items.push(node);if(node.data.expandable){node.data.expanded=true;}}
fnFilter(node.childNodes);});}}
fnFilter(store.data.items);var pushParentNode=function(node){if(node.parentNode){if(items.indexOf(node.parentNode)==-1){items.push(node.parentNode);if(node.parentNode.data.expandable){node.parentNode.data.expanded=true;}}
pushParentNode(node.parentNode);}}
var i=0,len=items.length;for(;i<len;i++){pushParentNode(items[i]);}
store.filterBy(function(node){var res=items.indexOf(node)>-1;return res;});},ReportFn:{showReport:function(reportInfo,uiContainer){var me=this;var lstReportNotFinish=[];if(reportInfo){if(lstReportNotFinish.indexOf(reportInfo.ReportID)!=-1){MISA.ShareFn.showWarningNotFinishYet();}else{if(reportInfo.ParameterFormName){me.showReportParam(reportInfo);}
else{var reportParam=uiContainer.getReportParam(reportInfo);if(uiContainer&&uiContainer.buildCustomObjectClass){reportInfo.CustomObjectClass=uiContainer.buildCustomObjectClass(reportInfo.ReportID);}
var chooseDate=MISA.DBOption.get(MISA.Constant.DBOptionKey.ShowDateOption)==1&&(Ext.isEmpty(reportParam)||Ext.isEmpty(reportParam.printMode)||reportParam.printMode!=2),chooseDepartment=reportInfo.AllowChooseDepartment,isShowPresentModeSelfInput=reportInfo.ReportDynamicID&&!reportInfo.IsSpecific09Layout&&reportInfo.PresentMode===MISA.Enumeration.PresentMode.EnterWhenCreate;if(chooseDate||chooseDepartment||isShowPresentModeSelfInput){config={key:"UcPrintDate",editMode:MISA.Enumeration.EditMode.Add,jsCaller:me,formIDCaller:me.formID,isSelf:true,reportParam:reportParam,reportInfo:reportInfo,chooseDate:chooseDate,chooseDepartment:chooseDepartment,isShowPresentModeSelfInput:isShowPresentModeSelfInput};MISA.Navigation.showUc(config);}else{me.updateReportInfo(reportInfo);me.showReportViewer(reportInfo,reportParam);}}}}},updateReportInfo:function(reportInfo){var showDateOption=MISA.DBOption.get(MISA.Constant.DBOptionKey.ShowDateOption)===null?2:MISA.DBOption.get(MISA.Constant.DBOptionKey.ShowDateOption),showLocationOption=MISA.DBOption.get(MISA.Constant.DBOptionKey.ShowLocationOption)===null?0:MISA.DBOption.get(MISA.Constant.DBOptionKey.ShowLocationOption),onlyShowLocationName=MISA.DBOption.get(MISA.Constant.DBOptionKey.OnlyShowLocationName)===null?true:MISA.DBOption.get(MISA.Constant.DBOptionKey.OnlyShowLocationName),location="....................",dd="...",mm="...",yyyy="......",today=new Date();switch(showDateOption){case MISA.Enumeration.ShowDateOption.SystemDate:dd=String(today.getDate()).padStart(2,'0');mm=String(today.getMonth()+1).padStart(2,'0');yyyy=today.getFullYear();break;case MISA.Enumeration.ShowDateOption.LeaveBlank:dd="...";mm="...";yyyy="......";break;default:dd="...";mm="...";yyyy="......";}
switch(showLocationOption){case MISA.Enumeration.ShowLocationOption.LeaveBlank:location="View/ErrorPage/ErrorPage30df.html";break;case MISA.Enumeration.ShowLocationOption.ShowWard:location=MISA.ContextData.WardName===null?"...":MISA.ContextData.WardName;break;case MISA.Enumeration.ShowLocationOption.ShowDistrict:location=MISA.ContextData.DistrictName===null?"...":MISA.ContextData.DistrictName;break;case MISA.Enumeration.ShowLocationOption.ShowProvince:location=MISA.ContextData.ProvinceName===null?"...":MISA.ContextData.ProvinceName;break;default:location="View/ErrorPage/ErrorPage30df.html";}
if(onlyShowLocationName){location=location.replace("Huyện","").replace("Phường","").replace("Quận","").replace("Thành phố","").replace("Thị trấn","").replace("Tỉnh","").replace("Xã","").trim();}
reportInfo.CustomObjectClass.signerTittle=`${location}, ngày ${dd} tháng ${mm} năm ${yyyy}`;},showReportViewer:function(reportInfo,reportParam,isMerge){var me=this;for(var prop in reportParam){reportParam[prop.toUpperCaseFirstChar()]=reportParam[prop];reportParam[prop.toLowerCaseFirstChar()]=reportParam[prop];}
if(MISA.CommonFn.checkRestrictedActions(MISA.Constant.RestrictedActions.PrintReport)){var param={reportParamValues:JSON.stringify(reportParam),reportInfo:JSON.stringify(reportInfo)};MISA.Service.ajax('ReportService','SaveReportParam',param,{async:false},function(result){if(result.Status){var config={key:'ReportViewer',reportInfo:reportInfo,reportParam:reportParam,reportHandlerID:result.Data,isMerge:isMerge};MISA.Navigation.showUc(config);}else if(result.Code===MISA.Constant.ResultCode.LicenseFail){MISA.CommonFn.showMessageLicenseFailByApp(MISA.Constant.RestrictedActions.PrintReport);}});}},showSignReportViewer:function(reportName,signReportID){var me=this;if(MISA.CommonFn.checkRestrictedActions(MISA.Constant.RestrictedActions.PrintReport)){var config={key:'SignReportViewer',signReportID:signReportID,reportName:reportName};MISA.Navigation.showUc(config);}},exportHealthReport:function(reportInfo,reportParam){var me=this;if(MISA.CommonFn.checkRestrictedActions(MISA.Constant.RestrictedActions.PrintReport)){var param={reportParamValues:JSON.stringify(reportParam),reportInfo:JSON.stringify(reportInfo)};MISA.Service.ajax('ReportService','ExportHealthReport',param,{async:false},function(result){if(result.Status){MISA.CommonFn.downloadFile(result.Data);}else if(result.Code===MISA.Constant.ResultCode.LicenseFail){MISA.CommonFn.showMessageLicenseFailByApp(MISA.Constant.RestrictedActions.PrintReport);}});}},exportExcelAllowanceDurationDetailReport:function(reportInfo,reportParam){var me=this;if(MISA.CommonFn.checkRestrictedActions(MISA.Constant.RestrictedActions.PrintReport)){var param={reportParamValues:JSON.stringify(reportParam),reportInfo:JSON.stringify(reportInfo)};MISA.Service.ajax('ReportService','ExportExcelAllowanceDuration',param,{async:false},function(result){if(result.Status){MISA.CommonFn.downloadFile(result.Data);}else if(result.Code===MISA.Constant.ResultCode.LicenseFail){MISA.CommonFn.showMessageLicenseFailByApp(MISA.Constant.RestrictedActions.PrintReport);}});}},showReportViewerInPanel:function(reportInfo,reportParam,isMerge,target){var me=this;if(MISA.CommonFn.checkRestrictedActions(MISA.Constant.RestrictedActions.PrintReport)){var param={reportParamValues:JSON.stringify(reportParam),reportInfo:JSON.stringify(reportInfo)};MISA.Service.ajax('ReportService','SaveReportParam',param,{async:false},function(result){if(result.Status){var config={key:'ReportViewerInPanel',reportInfo:reportInfo,reportParam:reportParam,reportHandlerID:result.Data,isMerge:isMerge,target:target,};MISA.Navigation.showUc(config);}});}},showReportParam:function(reportInfo){var me=this;if(reportInfo.ParameterFormName){var config={key:reportInfo.ParameterFormName,reportInfo:reportInfo,};MISA.Navigation.showUc(config);}},buildCustomObjectClassForSendReport:function(reportInfo){var me=this;oCustom={};switch(reportInfo.ReportID){case 'DS_TRICHNGANG_TAI_DONVI':oCustom.ToDate=MISA.CommonFn.formatValue(reportInfo.EndDate,MISA.Enumeration.DataType.DateType);break;case 'BM01_BNV_VC_TN':case 'BM02_BNV_VC_TN':case 'BM02VCBNV_AllBenefit':oCustom.year=reportInfo.EndDate;break;default:oCustom.PeriodName=me.getPeriodNameForReport(reportInfo.StartDate,reportInfo.EndDate,reportInfo.ReportPeriod);break;}
reportInfo.CustomObjectClass=oCustom;return reportInfo;},getPeriodNameForReport:function(fromDate,toDate,period){var me=this,periodName='';if(period&&fromDate&&toDate){switch(parseInt(period)){case MISA.Enumeration.DateRange.CUSTOM:periodName="Từ ngày {0} đến ngày {1}".format(fromDate.format("dd/MM/yyyy"),toDate.format("dd/MM/yyyy"));break;case MISA.Enumeration.DateRange.THISFISCALYEAR:periodName="Năm {0}".format(toDate.getFullYear());break;case MISA.Enumeration.DateRange.FISCALQUARTER1:periodName="Quý {0} năm {1}".format("I",toDate.getFullYear());break;case MISA.Enumeration.DateRange.FISCALQUARTER2:periodName="Quý {0} năm {1}".format("II",toDate.getFullYear());break;case MISA.Enumeration.DateRange.FISCALQUARTER3:periodName="Quý {0} năm {1}".format("III",toDate.getFullYear());break;case MISA.Enumeration.DateRange.FISCALQUARTER4:periodName="Quý {0} năm {1}".format("IV",toDate.getFullYear());break;case MISA.Enumeration.DateRange.JAN:periodName="Tháng {0} năm {1}".format("1",toDate.getFullYear());break;case MISA.Enumeration.DateRange.FEB:periodName="Tháng {0} năm {1}".format("2",toDate.getFullYear());break;case MISA.Enumeration.DateRange.MAR:periodName="Tháng {0} năm {1}".format("3",toDate.getFullYear());break;case MISA.Enumeration.DateRange.APR:periodName="Tháng {0} năm {1}".format("4",toDate.getFullYear());break;case MISA.Enumeration.DateRange.MAY:periodName="Tháng {0} năm {1}".format("5",toDate.getFullYear());break;case MISA.Enumeration.DateRange.JUN:periodName="Tháng {0} năm {1}".format("6",toDate.getFullYear());break;case MISA.Enumeration.DateRange.JUL:periodName="Tháng {0} năm {1}".format("7",toDate.getFullYear());break;case MISA.Enumeration.DateRange.AUG:periodName="Tháng {0} năm {1}".format("8",toDate.getFullYear());break;case MISA.Enumeration.DateRange.SEP:periodName="Tháng {0} năm {1}".format("9",toDate.getFullYear());break;case MISA.Enumeration.DateRange.OCT:periodName="Tháng {0} năm {1}".format("10",toDate.getFullYear());break;case MISA.Enumeration.DateRange.NOV:periodName="Tháng {0} năm {1}".format("11",toDate.getFullYear());break;case MISA.Enumeration.DateRange.DEC:periodName="Tháng {0} năm {1}".format("12",toDate.getFullYear());break;case MISA.Enumeration.DateRange.FIRSTSIXMONTH:periodName="6 tháng đầu năm {0}".format(toDate.getFullYear());break;case MISA.Enumeration.DateRange.LASTSIXMONTH:periodName="6 tháng cuối năm {0}".format(toDate.getFullYear());break;}
return periodName.toUpperCase();}},showWarningNotFinishYet:function(){MISA.MessageBox.showWarning('Chức năng đang hoàn thiện. Vui lòng sử dụng sau.');},getReportHandlerUrl:function(tokenID,format,display,type){var me=this;return MISA.ContextData.ReportSite+'Handler/ReportHandler.ashx?InfoParam={3}&tokenID={0}&format={1}&display={2}&type={4}'.format(tokenID,format,display,MISA.CommonFn.getKeyTokenDataIDForDownload(),type);},exportData:function(dataParam,exportParam){var fileType=exportParam.fileType;if(!exportParam.DataInfos){var fiels=['ListLayoutColumn','GroupBy','IsTree','SummaryProperty','DisplayGroupSummary','DisplayGroupCount'];var temp={};fiels.filter(function(item){temp[item]=exportParam[item];delete exportParam[item];});exportParam.DataInfos=[temp];}
var param={exportParam:MISAJSON.stringify(exportParam),dataParam:MISAJSON.stringify(dataParam)};MISA.Service.ajax("ExportService","ExportData",param,{async:true},function(msg){if(msg.Status==MISA.Enumeration.ServiceResult.Success){var url=MISA.CommonFn.ReportFn.getReportHandlerUrl(msg.Data,fileType,"attachment",8);MISA.CommonFn.downloadFile(url);}else{MISA.ExceptionManager.handledServiceResult(msg);}});},getExportColumnLayout:function(grid){var data=[],i=0,temp;grid.getVisibleColumnManager().getColumns().filter(function(c){if(c.dataIndex!=='IsSelectedKey'){temp={DataMemberBinding:c.dataIndex,ColumnCaption:c.text,ColumnDataType:c.dataType,Tooltip:c.tooltip,EnumName:c.enumName||null,Width:c.el?c.getWidth():c.cellWidth,SortOrder:i++,IsVisible:c.isVisible(),IsExpression:false,DecimalPrecision:c.decimalPrecision,ReverseLevel:1};var parentColumnUp=c.ownerCt,reverseLevel=2,reverseParents=[];while(!Ext.isEmpty(parentColumnUp)&&parentColumnUp instanceof Ext.grid.column.Column){reverseParents.push({ReverseLevel:reverseLevel++,ColumnName:parentColumnUp.text,ColumnID:parentColumnUp.id,ColumnTooltip:parentColumnUp.tooltip,ParentID:parentColumnUp.ownerCt instanceof Ext.grid.column.Column?parentColumnUp.ownerCt.id:null});parentColumnUp=parentColumnUp.ownerCt;}
temp.ReverseParentsJSON=reverseParents.length>0?MISAJSON.stringify(reverseParents):'';if(c.ownerCt instanceof Ext.grid.column.Column){temp.GroupName=c.ownerCt.id;temp.GroupCaption=c.ownerCt.text;temp.GroupTooltip=c.ownerCt.tooltip;if(c.ownerCt.ownerCt instanceof Ext.grid.column.Column){temp.RootGroupName=c.ownerCt.ownerCt.id;temp.RootGroupCaption=c.ownerCt.ownerCt.text;}}
data.push(temp);}});return data;},},prepareDataAppplyTo:function(data){return data.sort(function(a,b){return a>b}).join('');},getSourceDataApplyTo:function(data){var source=[],i=0;if(data&&data.length>0){for(i=0;i<data.length;i++){source.push(data.substring(i,i+1));}}
return source;},showHelp:function(topicID){var url=ContextDataConfig.HelpSite;if(topicID){url+=topicID;}
if(!topicID){var content=`
                        <div class="content-help-wrap">
                            <div class="help-title">Trợ giúp</div>
                            <hr class="help-line"/>
                            <div class="help-content help-system">
                                <div class="flex">
                                    <div class="back text-style"></div>
                                    <div class="open-new-tab text-style"><a target="_blank" href="${url}"><div class="ic-open-new-tab"></div>Mở trên tab khác</a></div>
                                </div>
                            </div>
                            <hr class="help-line"/>
                            <div class="help-content-child">
                                <iframe runat="server" id="Iframe1" class="agreementPdf" src="${url}" scrolling="yes" width="100%" height="100%"></iframe>
                            </div>
                        </div>
                    `;$('.new-help .salary-help-collapse-new').html(content);$('.new-help .salary-help-collapse-new').css('display','block');}
else{window.open(url,"_blank");}},getUrlHelp:function(topicID){var url=ContextDataConfig.HelpSite;if(topicID){url+=topicID;}
return url;},initISMAC:function(data){var obj=JSON.parse(data);_isInfo['uuid']=obj.Uuid;_isInfo['applicationid']=obj.ApplicationId;_isInfo['viewname']=obj.ViewName;_isInfo['productpackcode']=obj.ProductPackCode;_isInfo['applicationversion ']=obj.ApplicationVersion;_isInfo['username']=obj.UserName;_isInfo['organizationcode']=MISA.ContextData.BudgetCode;_isInfo['organizationunittype']=MISA.ContextData.IsAggregateOrg?1:2;(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=obj.JsPath;var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();},checkRestrictedActions:function(action){var oLicense=window.oLicense,allow=true,me=this;allow=me.showMessageLicenseFailByApp(action);return allow;},getInfoToMonitor:function(formID,actionName){},sendInfoToMonitor:function(infoSALA){},sendMonitorSALA:function(subSystemCode,action,actionName){},sendMonitorSALANew:function(subAppCode,subSystemCode,action,actionName){var checkActive=0;try{if(MISA.ContextData.IsUseMonitor&&subAppCode&&subSystemCode&&action&&actionName){var subSystemName=MISA.Resource.SubsystemName[subSystemCode]||"";MISA.Service.ajax("SystemService","GetSendMonitorComplete",{},{},function(msg){if(msg.Status==MISA.Enumeration.ServiceResult.Success){if(msg.Data){var data=MISAJSON.parse(msg.Data);if(subAppCode==="SALA"){checkActive=data.CheckActiveSALA;}else if(subAppCode==="PAYR"){checkActive=data.CheckActivePAYR;}}
var dataStatistic={ApplicationCode:"SALA",SubAppCode:subAppCode,SubSystemCode:subSystemCode,SubSystemName:subSystemName,OrganizationName:MISA.ContextData.OrganizationName,TypeLevel:MISA.ContextData.OrganizationGrade,SchoolLevel:MISA.ContextData.SchoolLevel,UnitName:MISA.ContextData.UnitName,Url:document.location.origin,User:MISA.ContextData.FullName,UserID:MISA.ContextData.UserId,Action:action,ActionName:actionName,OrganizationID:MISA.ContextData.OrganizationID,Role:MISA.ContextData.sRole,BudgetCode:MISA.ContextData.BudgetCode,TaxCode:MISA.ContextData.TaxCode,CheckActive:checkActive,IsAggregateOrg:MISA.ContextData.IsAggregateOrg?1:0};setTimeout(function(){MISA.HCSN.Monitor.send(dataStatistic,null);},0);}else{MISA.ExceptionManager.handledServiceResult(msg);}});}}catch(e){console.log("Lỗi monitor");}},sendMonitorSALANewV2:function(subAppCode,subSystemCode,action,actionName,checkActive){try{if(MISA.ContextData.IsUseMonitor&&subAppCode&&subSystemCode&&action&&actionName&&checkActive){var subSystemName=MISA.Resource.SubsystemName[subSystemCode]||"";var dataStatistic={ApplicationCode:"SALA",SubAppCode:subAppCode,SubSystemCode:subSystemCode,SubSystemName:subSystemName,OrganizationName:MISA.ContextData.OrganizationName,TypeLevel:MISA.ContextData.OrganizationGrade,SchoolLevel:MISA.ContextData.SchoolLevel,UnitName:MISA.ContextData.UnitName,Url:document.location.origin,User:MISA.ContextData.FullName,UserID:MISA.ContextData.UserId,Action:action,ActionName:actionName,OrganizationID:MISA.ContextData.OrganizationID,Role:MISA.ContextData.sRole,BudgetCode:MISA.ContextData.BudgetCode,TaxCode:MISA.ContextData.TaxCode,CheckActive:checkActive,IsAggregateOrg:MISA.ContextData.IsAggregateOrg?1:0};setTimeout(function(){MISA.HCSN.Monitor.send(dataStatistic,null);},0);}}catch(e){console.log("Lỗi monitor");}},getStandardData:function(info){if(info.SubAppCode&&info.SubSystemCode){var subSystemCode=info.SubSystemCode,typeSubsystemCode=MISA.Enumeration.SubsystemConfig[subSystemCode],subsystemName=MISA.Resource.SubsystemConfigName[subSystemCode];info.SubSystemName=subsystemName;switch(typeSubsystemCode){case MISA.Enumeration.SubsystemType.QLCB:info.SubAppCode=",DOC";break;case MISA.Enumeration.SubsystemType.SALA:info.SubAppCode=",SALA";break;case MISA.Enumeration.SubsystemType.PAYROLL:info.SubAppCode=",PAYR";break;case MISA.Enumeration.SubsystemType.SALA_PAYROLL:info.SubAppCode=info.SubAppCode.replace(",DOC","");break;}}
return info;},getSubSystemCodeForMonitor:function(nameUC){var uc=UIConfig[nameUC];if(uc&&uc.group){return uc.group;}else{return null;}},showMessageLicenseFailByApp:function(action){var oLicense=window.oLicense,usingApp,arrApp,i,allow=true,warningExpire='Thuê bao phần mềm {0} của Quý vị đã quá hạn. Quý vị chỉ được xem dữ liệu đã nhập.',arrMessageBuilding=[],msgSALA='',messageWarning='',msgPAYR='',hasSALA=false,hasPAYR=false,licenseSALA=false,licensePAYR=false;if(oLicense.DiclLicense){var restrictedSALA=oLicense.DiclLicense.SALA,restrictedPAYR=oLicense.DiclLicense.PAYR;usingApp=MISA.ContextData.UsingModuleStatusNew;arrApp=usingApp.split(';');arrApp=arrApp.remove("");for(i=0;i<arrApp.length;i++){switch(arrApp[i]){case MISA.Resource.UsingAppNew.Salary:hasSALA=true;licenseSALA=restrictedSALA&&restrictedSALA.indexOf(action)>-1?true:false;break;case MISA.Resource.UsingAppNew.Payroll:hasPAYR=true;licensePAYR=restrictedPAYR&&restrictedPAYR.indexOf(action)>-1?true:false;break;default:break;}}
hasSALA&&licenseSALA?arrMessageBuilding.push('Quản lý lập dự toán lương và cải cách tiền lương'):'';hasPAYR&&licensePAYR?arrMessageBuilding.push('Nghiệp vụ tính lương'):'';if(arrMessageBuilding.length>0){allow=false;for(i=1;i<arrMessageBuilding.length;i++){arrMessageBuilding[i]=arrMessageBuilding[i].toLowerCase();}
arrMessageBuilding=arrMessageBuilding.join(', ');messageWarning=warningExpire.format(arrMessageBuilding);}}
!allow?MISA.MessageBox.showWarning(messageWarning):'';return allow;},validateDetailEachRow:function(grd){var me=this,entName=grd.entityName,entObject=MISA.Entity[entName],allData=Ext.pluck(grd.store.getRange(),'data'),propName,isRequire,maxLength,maxValue,minValue,arrRequireProp=[],arrMaxLengthProp=[],arrMaxValueProp=[],arrMinValueProp=[],i,curRec,y,val,lstError,entProp,firstDetailError,cellPosition;for(propName in entObject){entProp=entObject[propName];if(entProp.hasOwnProperty("IsRequire")){arrRequireProp.push(propName);}
if(entProp.Type==='String'&&entProp.hasOwnProperty("MaxLength")){arrMaxLengthProp.push(propName);}}
if(arrRequireProp.length>0){for(i=0;i<allData.length;i++){curRec=allData[i];curRec['ListErrorObject']=[];lstError=curRec['ListErrorObject'];for(y=0;y<arrRequireProp.length;y++){propName=arrRequireProp[y];val=curRec[propName];if(typeof(val)==='undefined'||val==null||val.toString().isNullOrWhiteSpace()){lstError.push({ErrorType:MISA.Enumeration.ValidationErrorType.Required,Text:MISA.CommonFn.getEntityText(entName+'_'+propName)});cellPosition=cellPosition||{column:grd.getColumnManager().getColumns().findIndex(function(c){return c.dataIndex===propName}),row:i};}}
for(y=0;y<arrMaxLengthProp.length;y++){propName=arrMaxLengthProp[y];entProp=MISA.Entity[entName][propName];val=curRec[propName];if(typeof(val)!=='undefined'&&val!=null){if(val.length>entProp['MaxLength']){lstError.push({ErrorType:MISA.Enumeration.ValidationErrorType.MaxLength,Text:MISA.CommonFn.getEntityText(entName+'_'+propName)});}}}
for(y=0;y<arrMinValueProp.length;y++){propName=arrMinValueProp[y];entProp=MISA.Entity[entName][propName];val=curRec[propName];if(typeof(val)!=='undefined'&&val!=null&&!isNaN(val)){if(val<entProp['MinValue']){lstError.push({ErrorType:MISA.Enumeration.ValidationErrorType.MinValue,Text:MISA.CommonFn.getEntityText(entName+'_'+propName)});}}}
for(y=0;y<arrMaxValueProp.length;y++){propName=arrMaxValueProp[y];entProp=MISA.Entity[entName][propName];val=curRec[propName];if(typeof(val)!=='undefined'&&val!=null&&!isNaN(val)){val=new Decimal(val);if(val.comparedTo(entProp['MaxValue'])===1){lstError.push({ErrorType:MISA.Enumeration.ValidationErrorType.MaxValue,Text:MISA.CommonFn.getEntityText(entName+'_'+propName)});}}}
if(lstError.length>0){firstDetailError={EntityName:entName,EntityObject:curRec,grid:grd,cellPosition:cellPosition,};break;}}}
return firstDetailError;},getAcronymString:function(str,isUpperCase){var acronym='';if(!Ext.isEmpty(str)){acronym=str.split(/\s/).map(function(i){return i.charAt(0);}).join('');acronym=isUpperCase?acronym.toUpperCase():acronym;}
return acronym;},setCheckedRadioGroupFromValue:function(radioGroup,value){if(radioGroup&&radioGroup.items&&radioGroup.items.items.length>0&&value!=null){var checkedRadios=radioGroup.items.items.filter(function(a){return a.inputValue==String(value)});if(checkedRadios&&checkedRadios.length>0){checkedRadios.first().setValue(true);}}},moveArrayItem:function(arr,old_index,new_index){while(old_index<0){old_index+=arr.length;}
while(new_index<0){new_index+=arr.length;}
if(new_index>=arr.length){var k=new_index-arr.length+1;while(k--){arr.push(undefined);}}
arr.splice(new_index,0,arr.splice(old_index,1)[0]);return arr;},rebuildColumnFeatureSource:function(cbo,selectIndex){var me=this,arrFeatureSource=[],featureSource,optionCalculateSalaryNew=MISAJSON.parse(MISA.DBOption.dic.EstimateOption.OptionValue)||MISA.Enumeration.ConfirmEstimateOptionType.OptionOne;if(optionCalculateSalaryNew){featureSource=optionCalculateSalaryNew.ConfirmEstimateOptionDetail;if(featureSource){featureSource=featureSource.split(';');var enumData=MISA.Enumeration.FeatureSource;var keyEnumData=Object.keys(enumData);for(var i=0;i<keyEnumData.length;i++){if(featureSource.indexOf(enumData[keyEnumData[i]].toString())===-1){arrFeatureSource.push(keyEnumData[i])}}
let lSAVOrganiztion=MISA.ReportConfig.SAVOrganiztion.indexOf(MISA.ContextData.CompanyCode)===-1?["F12D1","F12D2","F13D1","F13D2"]:["F12","F13"];arrFeatureSource=arrFeatureSource.concat(lSAVOrganiztion);var ignoreKeys=arrFeatureSource.join('|');cbo.rebuildStore("FeatureSource",ignoreKeys,selectIndex);}}},rebuildFeatureSourceLoad:function(cbo,selectIndex,selectedValue){var me=this,arrFeatureSource=[],professional=MISA.ContextData.ProfessionalID,iSAVOrganiztion=MISA.ReportConfig.SAVOrganiztion.indexOf(MISA.ContextData.CompanyCode)>-1?true:false,arrigFeatureSource=iSAVOrganiztion?["F12","F13"]:["F12D1","F12D2","F13D1","F13D2"],cboStore;if(!iSAVOrganiztion){if(professional==MISA.Enumeration.Professional.Education||professional==MISA.Enumeration.Professional.Medical){if(professional==MISA.Enumeration.Professional.Education){arrFeatureSource=["F120","F130"];}}else{arrFeatureSource=["F100","F110","F120","F130"];}}
for(var i=0;i<arrFeatureSource.length;i++){arrigFeatureSource.push(arrFeatureSource[i]);}
var ignoreKeys=arrigFeatureSource.join('|');cbo.rebuildStore("FeatureSource",ignoreKeys,selectIndex);if(Ext.isEmpty(selectIndex)&&!Ext.isEmpty(selectedValue)){cboStore=cbo.store?Ext.pluck(cbo.store.data.items,'data'):[];selectIndex=cboStore.findIndex(function(e){return e['EnumValue']==selectedValue;});if(typeof(selectIndex)==='number'){if(selectIndex>=cboStore.length||selectIndex<0){selectIndex=0;}
cbo.setSelectedIndex(selectIndex);}}},KySo:{showMessageMisaKySo:function(){var sMessage='Để thực hiện ký điện tử, bạn cần cài đặt và khởi động công cụ MISA KYSO. Tải bộ cài <a id="download-ky-so" style="color:#2a6496" target="_blank" href="https://product.misa.vn/misasoftware/MISAKyso/MISA.KySo_Setup_latest.exe" >tại đây</a>.';var sTitle="Ký báo cáo không thành công";MISA.MessageBox.showWarning(sMessage,{},sTitle,function(btnID){switch(btnID){case MISA.Constant.MessageBox.OK:break;}});},initKySo:function(scope,showMaskFn,hideMaskFn){var option={showMask:function(){if(typeof(showMaskFn)=="function"){showMaskFn();}},hideMask:function(){if(typeof(hideMaskFn)=="function"){hideMaskFn();}},showMessage:function(type,code,message){switch(code){case MISAKYSO.CONSTANTS.errorCode.pluginNotExist:MISA.CommonFn.KySo.showMessageMisaKySo();break;default:}},download:function(){},connectError:function(){},};if(typeof(scope)=="object"){scope.kySoTool=$.fn.MISAKYSO(option);}},signXML:function(scope,paramFn){var paramFnExample={SellerTaxCode:"5700453290",XmlBase64:"",XmlName:"",TransactionID:"ID_1",SuccessFn:function(resData){},FailFn:function(resData){}}
if(typeof(scope)=="object"&&typeof(scope.kySoTool)=="object"&&typeof(paramFn)=="object"){var paramGetCert={productName:'MISA mTax',taxcode:'',sellerInfo:{sellerTaxCode:''},sessionId:MISA.Guid.newGuid(),files:[],isValidateTaxCode:false,isSelectFromCollection:true,}
scope.kySoTool.getCertInfo(paramGetCert).then((res)=>{var resData=MISAJSON.parse(res.data);if(resData.status){scope.detailSign=MISAJSON.parse(resData.data);var taxCodeInCert=scope.detailSign.BudgetCode;if(taxCodeInCert){taxCodeInCert=taxCodeInCert.replaceAll("-","");}
if(taxCodeInCert&&!taxCodeInCert.contains("MST:"+paramFn.SellerTaxCode.replaceAll("-",""))){MISA.MessageBox.showWarning("Mã số thuế trên hóa đơn không khớp với mã số thuế trên chứng thư số.");return;}
var param={productName:'MISA mTax',sellerInfo:{sellerTaxCode:paramFn.SellerTaxCode},serialNumbers:scope.detailSign.SerialNumber,files:[{data:paramFn.XmlBase64,index:1,name:paramFn.XmlName,transactionID:paramFn.TransactionID||"ID_1",fileExtension:".xml",text:paramFn.XmlBase64}],}
scope.kySoTool.signXml(param).then((res)=>{var resData=MISAJSON.parse(res.data);if(resData.status){if(typeof(paramFn.SuccessFn)=="function"){paramFn.SuccessFn(resData);}}
else{if(typeof(paramFn.FailFn)=="function"){paramFn.FailFn(resData);}else{if(resData.message=="Malformed reference element."){MISA.MessageBox.showWarning('Có lỗi xảy ra trong quá trình ký điện tử. Vui lòng liên hệ MISA để được hỗ trợ.','','Ký điện tử không thành công');}else if(resData.Code=="CancelSession"){}}}}).catch((e)=>{console.log(e);MISA.MessageBox.showWarning('Có lỗi xảy ra trong quá trình ký điện tử. Vui lòng liên hệ MISA để được hỗ trợ.','','Ký điện tử không thành công');});}}).catch((e)=>{});}}},syncActionBeforeMultiGrid:function(actionConfig,grids,functionCallback,isUnOffEvent){var actionConfigExample=['scroll','hover','select','sort MappingID','filter MappingID'],thisGridID;if(typeof(actionConfig)=='object'&&Ext.isArray(actionConfig)&&actionConfig.length>0&&typeof(grids)=='object'&&Ext.isArray(grids)&&grids.length>=2){grids.filter(function(g){actionConfig.filter(function(action){thisGridID=g.id;if(action=='scroll'){var scrollEle=g.getScrollable().getScrollElement(),scrollXDistance,scrollYDistance;isUnOffEvent?null:scrollEle.off('scroll');scrollEle.on('scroll',function(action,ele){scrollXDistance=scrollEle.getScrollLeft();scrollYDistance=scrollEle.getScrollTop();grids.filter(function(otherG){if(otherG.id!=thisGridID){otherG.getScrollable().getScrollElement().setScrollLeft(scrollXDistance);otherG.getScrollable().getScrollElement().setScrollTop(scrollYDistance);}})
if(typeof(functionCallback)=="function"){functionCallback(action,g,grids);}})}
if(action=='select'){isUnOffEvent?null:scrollEle.off('select');g.on('select',function(event,record,rowIdx){grids.filter(function(otherG){if(otherG.id!=thisGridID){otherG.getSelectionModel().select(rowIdx);}})
if(typeof(functionCallback)=="function"){functionCallback(action,g,grids);}})}
if(action=='hover'){isUnOffEvent?null:$('#'+g.body.id+' table.x-grid-item').off('mouseenter');$('#'+g.body.id+' table.x-grid-item').on('mouseenter',function(event){var rawidx=$(this).attr('data-recordindex');rawidx=parseInt(rawidx);grids.filter(function(otherG){if(otherG.id!=thisGridID){$($('#'+otherG.body.id+' table.x-grid-item')[rawidx]).addClass('x-grid-item-over');}})
if(typeof(functionCallback)=="function"){functionCallback(action,g,grids);}})
isUnOffEvent?null:$('#'+g.body.id+' table.x-grid-item').off('mouseleave');$('#'+g.body.id+' table.x-grid-item').on('mouseleave',function(event){var rawidx=$(this).attr('data-recordindex');rawidx=parseInt(rawidx);grids.filter(function(otherG){if(otherG.id!=thisGridID){$($('#'+otherG.body.id+' table.x-grid-item')[rawidx]).removeClass('x-grid-item-over');}})
if(typeof(functionCallback)=="function"){functionCallback(action,g,grids);}})}})})
return true;}else{return false;}},getValueDisplayByRoundMoney:function(value,roundNumber){if(!value||value==0){value='';}else{switch(roundNumber){case MISA.Enumeration.RoundMoney.NotRound:value=MISA.CommonFn.getByDigitDecimal(value,2);break;case MISA.Enumeration.RoundMoney.RoundBrass:value=MISA.CommonFn.getByDigitDecimal(value,0);break;case MISA.Enumeration.RoundMoney.RoundHundredBrass:value=MISA.CommonFn.getByDigitDecimal((value*0.01).toFixed(0)*100,0);break;case MISA.Enumeration.RoundMoney.RoundThousandBrass:value=MISA.CommonFn.getByDigitDecimal((value*0.001).toFixed(0)*1000,0);break;case 50:value=MISA.CommonFn.getByDigitDecimal((value*0.000001).toFixed(0)*1000000,0);break;case MISA.Enumeration.RoundMoneySalary.RoundUpBrass:value=Math.ceil(value);value=MISA.CommonFn.getByDigitDecimal(value,0);break;case MISA.Enumeration.RoundMoneySalary.RoundUpHundredBrass:value=Math.ceil(value/100)*100;value=MISA.CommonFn.getByDigitDecimal((value*0.01).toFixed(0)*100,0);break;case MISA.Enumeration.RoundMoneySalary.RoundUpThousandBrass:value=Math.ceil(value/1000)*1000;value=MISA.CommonFn.getByDigitDecimal((value*0.001).toFixed(0)*1000,0);break;case MISA.Enumeration.RoundMoneySalary.RoundDownBrass:value=Math.floor(value);value=MISA.CommonFn.getByDigitDecimal(value,0);break;case MISA.Enumeration.RoundMoneySalary.RoundDownHundredBrass:value=Math.floor(value/100)*100;value=MISA.CommonFn.getByDigitDecimal((value*0.01).toFixed(0)*100,0);break;case MISA.Enumeration.RoundMoneySalary.RoundDownThousandBrass:value=Math.floor(value/1000)*1000;value=MISA.CommonFn.getByDigitDecimal((value*0.001).toFixed(0)*1000,0);break;}}
return value;},getValueFormatByRoundMoney:function(value,roundNumber){if(!value||value==0){value=0;}else{switch(roundNumber){case MISA.Enumeration.RoundMoney.NotRound:value=parseFloat(value.toFixed(2));break;case MISA.Enumeration.RoundMoney.RoundBrass:value=Math.round(value);break;case MISA.Enumeration.RoundMoney.RoundHundredBrass:value=Math.round(value/100)*100;break;case MISA.Enumeration.RoundMoney.RoundThousandBrass:value=Math.round(value/1000)*1000;break;case MISA.Enumeration.RoundMoneySalary.RoundUpBrass:value=Math.ceil(value);break;case MISA.Enumeration.RoundMoneySalary.RoundUpHundredBrass:value=Math.ceil(value/100)*100;break;case MISA.Enumeration.RoundMoneySalary.RoundUpThousandBrass:value=Math.ceil(value/1000)*1000;break;case MISA.Enumeration.RoundMoneySalary.RoundDownBrass:value=Math.floor(value);break;case MISA.Enumeration.RoundMoneySalary.RoundDownHundredBrass:value=Math.floor(value/100)*100;break;case MISA.Enumeration.RoundMoneySalary.RoundDownThousandBrass:value=Math.floor(value/1000)*1000;break;}}
return value;},};MISA.ContextData={init:function(){var me=this;if(typeof ContextDataConfig!=='undefined'){Ext.apply(me,ContextDataConfig);}},reloadContextData:function(loadFn,scope){var me=this,url='/Handler/DownloadHandler.ashx?DType=7&v='+(new Date()).getTime().toString();delete me.navCallback;if(loadFn&&scope){me.navCallback=loadFn.bind(scope);}
var otp={url:url,onLoad:me.onReloadCompleted.bind(me),};Ext.Loader.loadScript(otp);},reloadContextData_ForOrganizationInfo:function(loadFn,scope,propSet){var result=false;if(Ext.isEmpty(propSet)||!Ext.isArray(propSet)){}else{MISA.Service.ajax('SystemService','ReloadOrganizationCache',{},{},function(result){if(result.Status==MISA.Enumeration.ServiceResult.Success){var orgData=MISAJSON.parse(result.Data);if(MISA&&MISA.ContextData){if(propSet&&Ext.isArray(propSet)&&propSet.length>0){propSet.filter(function(prop){if(MISA.ContextData.hasOwnProperty(prop)){MISA.ContextData[prop]=orgData[prop];}})}else{for(var prop in orgData){if(MISA.ContextData.hasOwnProperty(prop)){MISA.ContextData[prop]=orgData[prop];}}}
result=true;}
if(loadFn&&typeof(loadFn)=="function"&&scope){me.navCallback=loadFn.bind(scope);}}else{MISA.ExceptionManager.handledServiceResult(msg);result=false;}})}
return result;},onReloadCompleted:function(){var me=this;me.init();if(me.navCallback){me.navCallback();}},};MISA.ContextData.init();MISA.DBOption={dic:null,dboptionHandlerLink:MISA.CommonFn.getBaseUrl()+'Handler/DownloadHandler.ashx?DType=3&v=',get:function(key){var me=this;var opt=null;if(!me.dic&&DBOptionConfig){if(DBOptionConfig&&DBOptionConfig.length>0){me.dic={};for(var i=0;i<DBOptionConfig.length;i++){var item=DBOptionConfig[i],optionName=item["OptionName"];me.dic[optionName]=item;}}}
if(me.dic&&me.dic.hasOwnProperty(key)){var item=me.dic[key];opt=item["Value"];}
return opt;},reloadDBOption:function(loadFn,scope){var me=this,url=me.dboptionHandlerLink+(new Date()).getTime().toString();delete me.navCallback;if(loadFn&&scope){me.navCallback=loadFn.bind(scope);}
var otp={url:url,onLoad:me.onReloadCompleted.bind(me),};me.dic=null;DBOptionConfig=null;Ext.Loader.loadScript(otp);},onReloadCompleted:function(){var me=this;me.get('');if(me.navCallback){me.navCallback();}},};MISA.CustomValidate={fieldValidate:null,getFieldValidByUserControl:function(keyUC){var me=this,data=null;if(!me.fieldValidate){me.callServiceGetFieldValiate();}
if(me.fieldValidate&&!Ext.isEmpty(keyUC)){arrKeyUc=keyUC.split(',');data=me.fieldValidate.filter(function(e){return(arrKeyUc.indexOf(e.TableName)!=-1)&&e.Selected;});}
return data;},reloadFieldValidate:function(){var me=this;me.callServiceGetFieldValiate(true);},callServiceGetFieldValiate:function(resetCache){var me=this;if(!me.fieldValidate||resetCache){MISA.Service.ajax("DictionaryService","GetAllRequireInfo",{},{async:false},function(msg){if(msg.Status==MISA.Enumeration.ServiceResult.Success){me.fieldValidate=JSON.parse(msg.Data);}else{MISA.ExceptionManager.handledServiceResult(msg);}});}},checkEmptyControl:function(control){var me=this,arrIgnoreControlTypes=['misaradiobuttongroup'],arrDateTypes=['misadatefieldgroup','misaswitchdate','misanumberfieldgroup'],arrComboTypes=['misacomboboxenumgroup'],value;if(arrIgnoreControlTypes.indexOf(control.xtype)!=-1){value=true;}
else if(arrDateTypes.indexOf(control.xtype)!=-1){value=control.getValue();}
else if(arrComboTypes.indexOf(control.xtype)!=-1){value=(control.getValue()||control.getDisplayValue());}
else{value=control.value;}
return Ext.isEmpty(value);},validateCustomFields:function(keyUC,controls,pageTitle){var me=this,res=true,arrRequireInfo;arrInvalidFields=[];arrRequireInfo=me.getFieldValidByUserControl(keyUC);if(arrRequireInfo&&controls){arrRequireInfo.filter(function(e){var fieldKeys=Object.keys(controls);for(var i=0;i<fieldKeys.length;i++){field=fieldKeys[i];if(!Array.isArray(controls[field])){continue;}
controls[field].filter(function(control){var dom=$('#'+control.getId());var isEmpty=me.checkEmptyControl(control);if(control.isVisible()&&dom.is(':visible')&&!control.disabled){if(control.setField&&control.setField==e.ColumnField&&isEmpty){if(e.GroupName){control.GroupName=e.GroupName;}
arrInvalidFields.push(control);}}});}});}
if(arrInvalidFields.length>0){res=false;me.showErrNotValidate(arrInvalidFields,pageTitle);}
return res;},showErrNotValidate:function(ctrls,pageTitle){var me=this,contentMess="Các thông tin sau không được để trống:",titleMess="Không cất được "+(pageTitle?pageTitle:'hồ sơ');if(ctrls){ctrls.filter(function(e){contentMess+="<br>- "+(e.GroupName?(e.GroupName+': '):'')+e.fieldLabel;});}
MISA.MessageBox.showConfirm(contentMess,titleMess,function(btnID){if(btnID==MISA.Constant.MessageBox.OK){if(ctrls&&ctrls.first()){ctrls.first().focus();}}},me,{buttons:Ext.Msg.OK});},};MISA.ComboboxFn={buildColumnTemplate:function(cbo){var me=cbo;switch(me.templateId){case 'LookupContact':this.buildColumnTemplate_Employee(cbo);break;default:this.buildColumnTemplate_default(cbo,me.templateId);}},buildColumnTemplate_Employee:function(cbo){var me=cbo,listConfigCls=" ms-boundlist  hide-paging-bar lookupContact",tplContent=""
+"<div class='cbo-header'>"
+"</div>"
+"<div class='cbo-content'>"
+"     <table class='ms-cbo-table-template' style='width:250px'>"
+"          <colgroup>"
+"               <col style='width:250px;'>"
+"          </colgroup>"
+"          <tpl for='.'>"
+"             <div class='m-col minWidth border mg-10 m-pic-one m-pointer-over'><div class='m-row pleft-1' onclick='oUcLookupContact.showInformation(\"{[this.getRenderDisplayText(values, 'EmployeeID', undefined)]}\")' id={[this.getRenderDisplayText(values, 'EmployeeID', undefined)]}'>"
+"             <div class='m-col' style='background: #ccc; width: 52px; height: 77px'>"
+"             <label runat='server'><Content><center><img src='{0}?type=0&FName={[this.getRenderDisplayText(values, 'EmployeeID', undefined)]}&format=png&&width=200&modifiedDate={1}' class='imgTemplatePreview'></center></Content></label></div>"
+"             <div class='m-col flex' style='padding-left: 10px'><div class='m-group-content'><div class='m-row hei-20 wei-bold'>"
+"             <label runat='server' style='max-width: 225px;  text-overflow: ellipsis; white-space: nowrap;overflow: hidden'  title='{[this.getRenderDisplayText(values, 'FullName', undefined)]}'>{[this.getRenderDisplayText(values, 'FullName', undefined)]}</label></div>"
+"             <div class='m-row hei-20'><label style='max-width: 225px;  text-overflow: ellipsis; white-space: nowrap;overflow: hidden'  title='{[this.getRenderDisplayText(values, 'JobPositionName', undefined)]}' runat='server' ID='lblResultTransferEmployee'>{[this.getRenderDisplayText(values, 'JobPositionName', undefined)]}</label></div>"
+"             <div class='m-row hei-20'><label style='max-width: 225px;  text-overflow: ellipsis; white-space: nowrap;overflow: hidden'  title='{[this.getRenderDisplayText(values, 'MobilePhone', undefined)]}' runat='server' ID='lblResultCodeEmployee'>SĐT: {[this.getRenderDisplayText(values, 'MobilePhone', undefined)]}</label></div>"
+"             <div class='m-row hei-20'><label style='max-width: 225px;  text-overflow: ellipsis; white-space: nowrap;overflow: hidden'  title='{[this.getRenderDisplayText(values, 'OfficeEmail', undefined)]}' runat='server' ID='lblResultPosition'>Email: {[this.getRenderDisplayText(values, 'OfficeEmail', undefined)]}</label></div></div></div></div></div>"
+"          </tpl>"
+"     </table>"
+"</div>";tplContent=tplContent.format(MISA.CommonFn.getImageHandlerUrl(),new Date().getTime());me.listConfig={cls:listConfigCls,tpl:MISA.ComboboxFn.getXTemplate(me,tplContent),};},getCustomClassItem:function(templateId,values){var customCls='';switch(templateId){default:customCls='';break;}
return customCls;},getCurrentSortGrid:function(grd){var sort=grd.sort,sorters=grd.store.sorters;if(!Ext.isEmpty(sorters.items)&&sorters.items.length>0){for(var i=0;i<sorters.items.length;i++){var item=sorters.items[i],direction=item._direction;if(direction!=="NONE"){if(i>0){sort+=", "+item._property;}else{sort=item._property;}
if(direction==="DESC"){sort+=" DESC";}}}}
return sort;},getXTemplate:function(cbo,tplContent){var me=cbo;var tpl=new Ext.XTemplate(tplContent,{getTreeNodeLevel:function(values){if(values.Grade){value=values.Grade;}
else
if(values.MISACodeID){value=values.MISACodeID.split('index.html').length-2;}
else if(values.MISACode){value=values.MISACode.split('index.html').length-2;}else{value=1;}
var pLeft=((value-1)*20);if(pLeft==0){pLeft=5;}
return "padding-left: "+pLeft+"px;";},getTreeNodeClass:function(values){return values.IsParent?'tree-parent':'tree-leaf';},getRenderTitle:function(values,field){return this.getRenderText(values,field);},getRenderDisplayText:function(values,field,displayHtml){return this.getRenderText(values,field,{isEncodeValue:typeof displayHtml=='undefined'||!displayHtml});},checkItemSperator:function(values,field,allowSelectSeperator){if(allowSelectSeperator||values.IsSperator!==true){return false;}
else{return true;}},getRenderText:function(values,field,customConfig){var res='',config,m=this;for(var i=0;i<me.columnsConfig.length;i++){if(me.columnsConfig[i].DataField===field){config=me.columnsConfig[i];break;}}
if(config){switch(field){case 'EnptyColumn':break;default:var store=m.field.getStore(),f=store.getFieldByName(field);text=values[field];if(typeof text=='string'&&customConfig&&customConfig.isEncodeValue){res=MISA.CommonFn.processDisplayText(text);}else{res=MISA.CommonFn.formatValue(text,f.type,config);}}}
return res;}});return tpl;},buildColumnTemplate_default:function(cbo,templateID){var me=cbo,clsCustom=(templateID=="EmployeeStatus")?"EmployeeStatusCombo":'';if(!me.listConfig){var listConfigCls=' ms-boundlist ',arrLength=me.columnsConfig.length;if(!me.showPaging){listConfigCls+=' hide-paging-bar ';}
switch(templateID){case "BudgetCodeAndOrganizationName":listConfigCls+=' col-organization ';break;case "PositionSumRow":listConfigCls+=' PositionSumRow-picker ';break;default:break;}
if(me.columnsConfig&&arrLength>0){var totalWidth=0,sCol='',sHeader='',sContent='',sTreeClass='',style='',tempWidth;if(me.isTreeDisplay){sTreeClass='{[this.getTreeNodeClass(values)]}';}
for(var i=0;i<arrLength;i++){var col=me.columnsConfig[i];if(!col.Width){if(arrLength===1){col.Width="100%";totalWidth="100%";}else{tempWidth=(i===0)?80:200;col.Width=String(tempWidth)+'px';totalWidth+=tempWidth;}}else{tempWidth=Ext.Number.from(col.Width);col.Width=String(tempWidth)+'px';totalWidth+=tempWidth;}
sCol+='<col style="width:'+col.Width+';">';var cls='bl-node',alginCls='';switch(col.DataType){case MISA.Enumeration.DataType.NumberType:case MISA.Enumeration.DataType.PercentType:case MISA.Enumeration.DataType.Quantity:alginCls='node-right';break;case MISA.Enumeration.DataType.DateTimeType:case MISA.Enumeration.DataType.DateType:alginCls='node-center';break;}
if(col.Align){alginCls='node-'+String(col.Align).toLowerCase();}
if(alginCls){cls+=' '+alginCls;}
style='style="width:'+col.Width+';';if(i===0&&me.isTreeDisplay){style+='{[this.getTreeNodeLevel(values)]}';}
style+='"';sHeader+='<td><span title="'+String(col.HeaderTooltip||'').removeHtmlTag()+'">'+col.HeaderText+'</span></td>';sContent+='<td class="'+cls+'"><div class="cbo-item {[MISA.ComboboxFn.getCustomClassItem("'+me.templateId+'",values)]}" '+style+' title="{[this.getRenderTitle(values, "'+col.DataField+'")]}"> {[this.getRenderDisplayText(values, "'+col.DataField+'", '+col.displayHtml+')]}</div></td>';}
var tplString='<table class="ms-cbo-table-template '+clsCustom+'" ';if(typeof totalWidth=='number'){totalWidth=String(totalWidth+40)+'px';}
tplString+='style="width:'+totalWidth+'">';tplString+='<colgroup>'+sCol+'</colgroup>';var tplHeader='';if(arrLength>1){tplHeader=tplString;tplHeader+='<tr class="ms-cbo-hearder">'+sHeader+'</tr>';me.matchFieldWidth=false;listConfigCls+=' multi-column';tplHeader+='</table>';}
tplString+='<tpl for=".">'+'<tpl if="'+'this.checkItemSperator(values,'+"'"+col.DataField+"',"+me.allowSelectSeperator+')">'
+'<tr class="x-boundlist-item ms-cbo-item'+sTreeClass+'" style="display:none">'+sContent+'</tr>'
+'<tr><td '+style+' class="'+cls+'">{[this.getRenderDisplayText(values, "'+col.DataField+'", '+col.displayHtml+')]}</td></tr>'
+'<tpl else>'
+'<tr class="x-boundlist-item ms-cbo-item'+sTreeClass+'">'+sContent+'</tr>'
+'</tpl>'
+'</tpl>';tplString+='</table>';var tplContent="<div class='cbo-header'>"+tplHeader+'</div><div class="cbo-content">'+tplString+'</div>';var tpl=MISA.ComboboxFn.getXTemplate(me,tplContent);}
me.listConfig={cls:listConfigCls,tpl:tpl,};}},};MISA.LayoutFn={buildListColumn:function(grid,templateConfigs,isFixColumn,fixColumnNumber,customModelFields){var me=this,columns=[],fieldNames=[],groups={};templateConfigs.filter(function(c){var columnGroup=null;var column=me.generateColumnConfig(c,grid);if(typeof fnCustomColumn=="function"){fnCustomColumn(column);}
if(typeof c.GroupName!="undefined"&&!Ext.isEmpty(c.GroupName)){columnGroup=groups[c.GroupName];if(!columnGroup){columnGroup=me.generateColumnGroupConfig(c);groups[c.GroupName]=columnGroup;columns.push(columnGroup);}
columnGroup.columns.push(column);}else{columns.push(column);}
fieldNames.push(c.ColumnField);if(c.DataDisplay){fieldNames.push(c.DataDisplay);}
if(!Ext.isEmpty(c.FieldNames)){c.FieldNames.split(',').filter(function(fieldName){fieldNames.push(fieldName);});}});if(isFixColumn&&fixColumnNumber){if(fixColumnNumber>columns.length){fixColumnNumber=columns.length;}
for(var i=0;i<fixColumnNumber;i++){columns[i].locked=true;}}
var itemFlex=columns.filter(function(item){return item.flex&&item.flex>0});if(itemFlex.length==0){columns.last().flex=1;columns.last().minWidth=columns.last().width;}
if(Ext.isArray(customModelFields)&&customModelFields.length>0){customModelFields.filter(function(name){if(fieldNames.indexOf(name)===-1){fieldNames.push(name);}});}
grid.store.model=MISA.CommonFn.buildModel(Ext.id("{0}_Model".format(grid.id)),grid.entityName,fieldNames,grid.config.itemId,grid.phantomKey);return columns;},generateColumnGroupConfig:function(c){var col={"uniqueName":c.GroupName,text:c.GroupCaption,tooltip:c.GroupTooltip,xtype:MISA.Enumeration.XType.MISAColumn,columns:[],cls:"cls-dinamic-colgroup"+(c.colCls?c.colCls:''),};return col;},generateColumnConfig:function(cfg,grid){var col={id:Ext.id("{0}_col_{1}".format(grid.id,cfg.ColumnField)),dataIndex:cfg.ColumnField,text:cfg.ColumnTitle,gridParent:grid,dataType:cfg.DataType,toolTip:cfg.ToolTip,filterable:cfg.Filterable==null?true:cfg.Filterable,flex:cfg.Flex};if(cfg.ColumnFlex){col.flex=cfg.ColumnFlex
col.minWidth=cfg.ColumnWidth;}else{col.width=cfg.ColumnWidth;}
if(cfg.Cls){col.cls=cfg.Cls;}
switch(cfg.DataType){case MISA.Enumeration.DataType.EnumType:col.xtype="misacomboboxenumcolumn";col.enumName=cfg.EnumName;break;case MISA.Enumeration.DataType.NumberType:col.xtype="misanumbercolumn";col.align="Right";col.showFilterButton=true;break;case MISA.Enumeration.DataType.DateType:col.xtype="misadatecolumn";if(cfg.FilterEnumName){col.filterEnumName=cfg.FilterEnumName;}
break;case MISA.Enumeration.DataType.BooleanType:col.xtype="misacheckcolumn";break;case MISA.Enumeration.DataType.DateTimeType:col.xtype="misadateofbirthcolumn";col.dataType=MISA.Enumeration.DataType.EnumType;col.dataDisplay=cfg.DataDisplay;if(cfg.FilterEnumName){col.filterEnumName=cfg.FilterEnumName;}
break;case MISA.Enumeration.DataType.ComboType:col.xtype="misacomboboxcolumn";col.dataDisplay=cfg.DataDisplay;var storeParam=null;if(cfg.ParameterMode){storeParam=Ext.create("MISA.Control.MISAStoreParameter",{mode:cfg.ParameterMode,name:cfg.ParameterName,value:cfg.ParameterValue});}
col.items=[{xtype:"misacomboboxdata",id:"{0}_{1}".format(col.id,"ComboboxData"),setField:cfg.ColumnField,valueField:cfg.ValueField,displayField:cfg.DisplayField,entityName:cfg.EntityName,forceSelection:cfg.ForceSelection,autoGenerateStore:cfg.AutoGenerateStore,getDataURL:cfg.GetDataURL,customStoreParameter:storeParam?storeParam:null}];break;case MISA.Enumeration.DataType.StringType:default:col.xtype="misacolumn";}
return col;},};MISA.Intergration={isUse:null,organizationID:null,checkOrganizationIsSync:function(){var me=this,orgID=MISA.ContextData.OrganizationID;if(me.organizationID==null||me.organizationID!=orgID){me.organizationID=MISA.ContextData.OrganizationID;}
if(me.isUse==null){MISA.Service.ajax('SystemService','CheckOrganizationIsSync',{organizationID:me.organizationID},{async:false},function(result){if(result.Status==MISA.Enumeration.ServiceResult.Success){me.isUse=true;}else{me.isUse=false;}});}
return me.isUse;},removeSignVietnameseString:function(str){str=str.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a");str=str.replace(/À|Á|Ạ|Ả|Ã|Â|Ầ|Ấ|Ậ|Ẩ|Ẫ|Ă|Ằ|Ắ|Ặ|Ẳ|Ẵ/g,"A");str=str.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e");str=str.replace(/È|É|Ẹ|Ẻ|Ẽ|Ê|Ề|Ế|Ệ|Ể|Ễ/g,"E");str=str.replace(/ì|í|ị|ỉ|ĩ/g,"i");str=str.replace(/Ì|Í|Ị|Ỉ|Ĩ/g,"I");str=str.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o");str=str.replace(/Ò|Ó|Ọ|Ỏ|Õ|Ô|Ồ|Ố|Ộ|Ổ|Ỗ|Ơ|Ờ|Ớ|Ợ|Ở|Ỡ/g,"O");str=str.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u");str=str.replace(/Ù|Ú|Ụ|Ủ|Ũ|Ư|Ừ|Ứ|Ự|Ử|Ữ/g,"U");str=str.replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y");str=str.replace(/Ỳ|Ý|Ỵ|Ỷ|Ỹ/g,"Y");str=str.replace(/đ/g,"d");str=str.replace(/Đ/g,"D");str=str.replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'| |\"|\&|\#|\[|\]|~|$|_/g,"_");str=str.replace(/_+_/g,"_");str=str.replace(/^\_+|\_+$/g,"");return str;},};